<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercice de Style - GÃ©nÃ©rateur IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';
        window.transformers = { pipeline };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .story-text { line-height: 1.8; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ­ Exercice de Style</h1>
            <p class="text-gray-200 text-lg">GÃ©nÃ©rateur d'histoires IA par <strong>Luc Bizeul</strong></p>
            <a href="https://www.linkedin.com/in/luc-bizeul/" target="_blank" class="text-blue-200 hover:text-blue-100 transition-colors">
                LinkedIn Profile ğŸ”—
            </a>
            <div class="mt-2">
                <span class="bg-green-500/30 px-3 py-1 rounded-full text-sm text-green-200">
                    ğŸ§  IA intÃ©grÃ©e dans le navigateur
                </span>
            </div>
        </div>

        <!-- AI Status -->
        <div id="aiStatus" class="max-w-4xl mx-auto mb-6">
            <div id="loadingAI" class="glass-effect rounded-lg p-4 border border-white/20 text-center">
                <div class="pulse text-yellow-300">âš™ï¸ Chargement du modÃ¨le IA...</div>
                <div class="text-sm text-gray-300 mt-2">PremiÃ¨re utilisation : tÃ©lÃ©chargement en cours (~50MB)</div>
                <div class="w-full bg-gray-600 rounded-full h-2 mt-3">
                    <div id="progressBar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
            <div id="aiReady" class="hidden glass-effect rounded-lg p-4 border border-green-500/30 text-center">
                <div class="text-green-300">âœ… IA prÃªte Ã  gÃ©nÃ©rer des histoires !</div>
            </div>
        </div>

        <!-- Main Interface -->
        <div class="max-w-4xl mx-auto glass-effect rounded-2xl p-8 border border-white/20">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Controls -->
                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-white mb-4">ğŸ¨ Configuration</h2>
                    
                    <!-- Style Selection -->
                    <div>
                        <label class="block text-white font-medium mb-2">Style littÃ©raire :</label>
                        <select id="styleSelect" class="w-full p-3 rounded-lg bg-white/10 text-white border border-white/30 focus:border-blue-300 focus:outline-none">
                            <option value="romantique">ğŸŒ¹ Romantique</option>
                            <option value="realiste">ğŸ“– RÃ©aliste</option>
                            <option value="surealiste">ğŸŒ€ SurrÃ©aliste</option>
                            <option value="noir">ğŸ•´ï¸ Polar/Noir</option>
                            <option value="fantastique">âœ¨ Fantastique</option>
                            <option value="science-fiction">ğŸš€ Science-Fiction</option>
                            <option value="humoristique">ğŸ˜„ Humoristique</option>
                            <option value="tragique">ğŸ˜¢ Tragique</option>
                            <option value="epique">âš”ï¸ Ã‰pique</option>
                            <option value="minimaliste">â–«ï¸ Minimaliste</option>
                        </select>
                    </div>

                    <!-- Genre Selection -->
                    <div>
                        <label class="block text-white font-medium mb-2">Genre narratif :</label>
                        <select id="genreSelect" class="w-full p-3 rounded-lg bg-white/10 text-white border border-white/30 focus:border-blue-300 focus:outline-none">
                            <option value="nouvelle">ğŸ“š Nouvelle</option>
                            <option value="conte">ğŸ§š Conte</option>
                            <option value="journal">ğŸ“” Journal intime</option>
                            <option value="rapport">ğŸ“‹ Rapport officiel</option>
                            <option value="lettre">âœ‰ï¸ Lettre</option>
                            <option value="dialogue">ğŸ’¬ Dialogue</option>
                            <option value="monologue">ğŸ—£ï¸ Monologue intÃ©rieur</option>
                            <option value="poeme">ğŸ­ PoÃ¨me en prose</option>
                        </select>
                    </div>

                    <!-- Narrator Profession -->
                    <div>
                        <label class="block text-white font-medium mb-2">MÃ©tier du narrateur :</label>
                        <input type="text" id="narratorJob" placeholder="ex: journaliste, mÃ©decin, Ã©tudiant..." 
                               class="w-full p-3 rounded-lg bg-white/10 text-white placeholder-gray-300 border border-white/30 focus:border-blue-300 focus:outline-none">
                    </div>

                    <!-- Creativity Level -->
                    <div>
                        <label class="block text-white font-medium mb-2">Niveau de crÃ©ativitÃ© :</label>
                        <select id="creativity" class="w-full p-3 rounded-lg bg-white/10 text-white border border-white/30 focus:border-blue-300 focus:outline-none">
                            <option value="0.3">ğŸ¯ PrÃ©cis et cohÃ©rent</option>
                            <option value="0.7" selected>ğŸ¨ Ã‰quilibrÃ©</option>
                            <option value="1.0">ğŸŒŸ TrÃ¨s crÃ©atif</option>
                        </select>
                    </div>

                    <!-- Generate Button -->
                    <button id="generateBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <span id="btnText">â³ Chargement de l'IA...</span>
                        <span id="btnLoader" class="hidden">ğŸ¯ GÃ©nÃ©ration en cours...</span>
                    </button>

                    <!-- Info -->
                    <div class="text-xs text-gray-300 bg-blue-500/10 p-3 rounded-lg border border-blue-500/20">
                        ğŸ’¡ <strong>100% local :</strong> Aucune donnÃ©e n'est envoyÃ©e vers des serveurs externes. L'IA fonctionne entiÃ¨rement dans votre navigateur !
                    </div>
                </div>

                <!-- Story Display -->
                <div class="space-y-4">
                    <h2 class="text-2xl font-semibold text-white mb-4">ğŸ“– Histoire gÃ©nÃ©rÃ©e</h2>
                    <div id="storyContainer" class="bg-white/10 rounded-lg p-6 min-h-96 border border-white/20">
                        <div id="storyPlaceholder" class="text-gray-300 text-center py-12">
                            <div class="text-6xl mb-4">ğŸ“</div>
                            <p>L'IA se prÃ©pare... Patience, Ã§a va Ãªtre magique !</p>
                        </div>
                        <div id="storyText" class="hidden text-white story-text"></div>
                        <div id="errorMessage" class="hidden text-red-300 p-4 bg-red-500/20 rounded-lg"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-200">
            <p>InspirÃ© par "Exercices de style" de Raymond Queneau</p>
            <p class="text-sm mt-2">PropulsÃ© par Transformers.js & Hugging Face ğŸ¤—</p>
        </div>
    </div>

    <script>
        // Global variables
        let storyData = null;
        let generator = null;
        let isAIReady = false;

        // Elements
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const storyPlaceholder = document.getElementById('storyPlaceholder');
        const storyText = document.getElementById('storyText');
        const errorMessage = document.getElementById('errorMessage');
        const loadingAI = document.getElementById('loadingAI');
        const aiReady = document.getElementById('aiReady');
        const progressBar = document.getElementById('progressBar');

        // Default story data (embedded as fallback)
        const defaultStoryData = {
            "@context": "https://schema.org/",
            "@graph": [
                {
                    "@type": "Person",
                    "@id": "#author",
                    "name": "Luc Bizeul",
                    "role": "Auteur",
                    "url": "https://www.linkedin.com/in/luc-bizeul/"
                },
                {
                    "@type": "myvocab:AgentInstruction",
                    "myvocab:instructionContent": "Demander un style et un genre pour l'histoire"
                },
                {
                    "@type": "myvocab:AgentInstruction",
                    "myvocab:instructionContent": "Tenir compte de tous les paramÃ¨tres de l'histoire"
                },
                {
                    "@type": "myvocab:AgentInstruction",
                    "myvocab:instructionContent": "n'utilise pas les identifiants pour nommer les personnages"
                },
                {
                    "@type": "myvocab:AgentInstruction",
                    "myvocab:instructionContent": "demande le mÃ©tier du narrateur"
                },
                {
                    "@type": "Person",
                    "@id": "#youth_man",
                    "ageRange": "18-25",
                    "neck": {
                        "@type": "BodyPart",
                        "height": "long",
                        "name": "cou"
                    },
                    "wearing": {
                        "@type": "WearAction",
                        "object": {
                            "@type": "Clothing",
                            "name": "chapeau",
                            "hasDecoration": "tresse",
                            "doesNotHaveDecoration": "ruban"
                        }
                    },
                    "gender": "Male",
                    "location": {
                        "@id": "#Autobus"
                    }
                },
                {
                    "@type": "Bus",
                    "@id": "Autobus"
                },
                {
                    "@type": "Conversation",
                    "@id": "#conversation1",
                    "emotionalTone": "vif",
                    "speaker": [
                        { "@id": "#youth_man" },
                        { "@id": "#other_traveller" }
                    ]
                },
                {
                    "@type": "Seat",
                    "@id": "#free_seat",
                    "name": "SiÃ¨ge libre"
                },
                {
                    "@type": "Person",
                    "@id": "#friend",
                    "name": "Ami"
                },
                {
                    "@type": "Button",
                    "name": "bouton supÃ©rieur"
                }
            ]
        };

        // Load story data from JSON with fallback
        fetch('./ExerciceDeStyle.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                storyData = data;
                console.log('ğŸ“– Histoire chargÃ©e depuis le fichier JSON:', storyData);
            })
            .catch(error => {
                console.log('âš ï¸ Fichier JSON non accessible, utilisation des donnÃ©es intÃ©grÃ©es');
                console.log('ğŸ’¡ Astuce: Pour utiliser le fichier externe, servez les fichiers via un serveur web');
                storyData = defaultStoryData;
                console.log('ğŸ“– Histoire chargÃ©e depuis les donnÃ©es par dÃ©faut:', storyData);
            });

        // Initialize AI Model
        async function initializeAI() {
            try {
                console.log('ğŸš€ Initialisation du modÃ¨le IA...');
                
                // Simulate progress for UX
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90;
                    progressBar.style.width = progress + '%';
                }, 500);

                // Initialize the text generation pipeline with better error handling
                try {
                    generator = await window.transformers.pipeline(
                        'text-generation',
                        'Xenova/distilgpt2',
                        {
                            progress_callback: (data) => {
                                if (data.status === 'downloading') {
                                    const percent = Math.round((data.loaded / data.total) * 100);
                                    progressBar.style.width = percent + '%';
                                }
                            }
                        }
                    );
                } catch (modelError) {
                    console.log('ğŸ”„ ModÃ¨le principal non disponible, utilisation du fallback...');
                    // Si le modÃ¨le franÃ§ais ne marche pas, on utilise un modÃ¨le plus petit
                    generator = null;
                    throw new Error('ModÃ¨le IA non disponible - mode template activÃ©');
                }

                clearInterval(progressInterval);
                progressBar.style.width = '100%';

                // Show success
                setTimeout(() => {
                    loadingAI.classList.add('hidden');
                    aiReady.classList.remove('hidden');
                    generateBtn.disabled = false;
                    btnText.textContent = 'ğŸ¯ GÃ©nÃ©rer l\'histoire';
                    isAIReady = true;
                    
                    storyPlaceholder.innerHTML = `
                        <div class="text-6xl mb-4">ğŸ­</div>
                        <p>SÃ©lectionnez vos paramÃ¨tres et gÃ©nÃ©rez votre histoire !</p>
                    `;
                    
                    console.log('âœ… IA prÃªte !');
                }, 1000);

            } catch (error) {
                console.log('ğŸ­ Activation du mode template intelligent...');
                
                // Fallback to template-based generation (no error shown to user)
                generator = null;
                isAIReady = true;
                generateBtn.disabled = false;
                btnText.textContent = 'ğŸ¯ GÃ©nÃ©rer l\'histoire';
                loadingAI.classList.add('hidden');
                
                // Show success message for template mode
                aiReady.innerHTML = '<div class="text-green-300">âœ… GÃ©nÃ©rateur d\'histoires prÃªt ! (Mode Templates)</div>';
                aiReady.classList.remove('hidden');
                
                storyPlaceholder.innerHTML = `
                    <div class="text-6xl mb-4">ğŸ­</div>
                    <p>SÃ©lectionnez vos paramÃ¨tres et gÃ©nÃ©rez votre histoire !</p>
                `;
                
                console.log('âœ… Mode template activÃ© !');
            }
        }

        // Generate story function
        async function generateStory() {
            const style = document.getElementById('styleSelect').value;
            const genre = document.getElementById('genreSelect').value;
            const narratorJob = document.getElementById('narratorJob').value || 'observateur anonyme';
            const creativity = parseFloat(document.getElementById('creativity').value);

            if (!isAIReady) {
                showError('âš ï¸ L\'IA n\'est pas encore prÃªte. Patientez...');
                return;
            }

            if (!storyData) {
                showError('âŒ Les donnÃ©es de l\'histoire ne sont pas encore chargÃ©es');
                return;
            }

            // Show loading
            setLoading(true);
            hideError();

            try {
                let generatedStory;

                if (generator) {
                    // AI-powered generation
                    const prompt = buildPrompt(style, genre, narratorJob);
                    console.log('ğŸš€ GÃ©nÃ©ration avec IA...');

                    const result = await generator(prompt, {
                        max_new_tokens: 200,
                        temperature: creativity,
                        do_sample: true,
                        repetition_penalty: 1.1
                    });

                    generatedStory = result[0].generated_text.replace(prompt, '').trim();
                } else {
                    // Fallback template-based generation
                    generatedStory = generateTemplateStory(style, genre, narratorJob);
                }

                displayStory(generatedStory, style, genre);

            } catch (error) {
                console.error('âŒ Erreur:', error);
                showError(`âŒ Erreur lors de la gÃ©nÃ©ration: ${error.message}`);
            } finally {
                setLoading(false);
            }
        }

        // Build prompt for AI based on JSON data
        function buildPrompt(style, genre, narratorJob) {
            if (!storyData) {
                return `Raconte une histoire simple dans le style ${style}.`;
            }

            const graph = storyData['@graph'];
            
            // Extract instructions from JSON
            const instructions = graph.filter(item => item['@type'] === 'myvocab:AgentInstruction');
            
            // Extract character details
            const youthMan = graph.find(item => item['@id'] === '#youth_man');
            const narrator = graph.find(item => item['@id'] === '#Narrator');
            const friend = graph.find(item => item['@id'] === '#friend');
            const otherTraveller = graph.find(item => item['@id'] === '#other_traveller');
            
            // Extract locations and objects
            const bus = graph.find(item => item['@type'] === 'Bus');
            const seat = graph.find(item => item['@type'] === 'Seat');
            const button = graph.find(item => item['@type'] === 'Button');
            
            // Extract actions
            const conversation1 = graph.find(item => item['@id'] === '#conversation1');
            const sitAction = graph.find(item => item['@type'] === 'SitAction');
            const wearAction = graph.find(item => item['@id'] === '#wear_coat');
            const fastenAction = graph.find(item => item['@type'] === 'FastenAction');
            
            const styleDescriptions = {
                'romantique': 'passionnÃ© et Ã©motionnel, avec des descriptions poÃ©tiques',
                'realiste': 'objectif et dÃ©taillÃ©, ancrÃ© dans la rÃ©alitÃ© quotidienne',
                'surealiste': 'onirique et Ã©trange, mÃ©langeant rÃªve et rÃ©alitÃ©',
                'noir': 'sombre et mystÃ©rieux, avec une atmosphÃ¨re tendue',
                'fantastique': 'merveilleux et magique, oÃ¹ l\'impossible devient possible',
                'science-fiction': 'futuriste et technologique, explorant les possibilitÃ©s de demain',
                'humoristique': 'lÃ©ger et amusant, avec des situations comiques',
                'tragique': 'mÃ©lancolique et dramatique, explorant la condition humaine',
                'epique': 'grandiose et hÃ©roÃ¯que, avec des enjeux importants',
                'minimaliste': 'Ã©purÃ© et concis, allant Ã  l\'essentiel'
            };

            let prompt = `En tant que ${narratorJob}, raconte cette histoire dans le style ${style} (${styleDescriptions[style]}) et le genre ${genre}.\n\n`;
            
            // Add specific instructions from JSON
            if (instructions.length > 0) {
                prompt += `Instructions importantes Ã  respecter :\n`;
                instructions.forEach(instruction => {
                    prompt += `- ${instruction['myvocab:instructionContent']}\n`;
                });
                prompt += `\n`;
            }
            
            // Build detailed character and scene description from JSON
            prompt += `Ã‰lÃ©ments prÃ©cis de l'histoire :\n`;
            
            if (youthMan) {
                prompt += `- Personnage principal : jeune homme de ${youthMan.ageRange} ans`;
                if (youthMan.neck) {
                    prompt += `, avec un ${youthMan.neck.name} ${youthMan.neck.height}`;
                }
                if (youthMan.wearing && youthMan.wearing.object) {
                    const hat = youthMan.wearing.object;
                    prompt += `, portant un ${hat.name}`;
                    if (hat.hasDecoration) {
                        prompt += ` avec une ${hat.hasDecoration}`;
                    }
                    if (hat.doesNotHaveDecoration) {
                        prompt += ` (sans ${hat.doesNotHaveDecoration})`;
                    }
                }
                prompt += `\n`;
            }
            
            if (bus) {
                prompt += `- Lieu : dans un autobus\n`;
            }
            
            if (conversation1) {
                prompt += `- Une conversation au ton ${conversation1.emotionalTone} avec un autre voyageur\n`;
            }
            
            if (seat) {
                prompt += `- Le jeune homme trouve un ${seat.name.toLowerCase()} et s'y assoit\n`;
            }
            
            if (friend && fastenAction && button) {
                prompt += `- Plus tard, il rencontre un ami qui lui conseille de faire quelque chose avec le ${button.name} de son pardessus\n`;
            }
            
            prompt += `\nRaconte cette histoire en respectant parfaitement le style ${style} et le genre ${genre}. L'histoire doit faire environ 150-250 mots.\n\nHistoire :`;
            
            return prompt;
        }

        // Template-based fallback generation using JSON data
        function generateTemplateStory(style, genre, narratorJob) {
            if (!storyData) {
                return `Histoire simple : Un ${narratorJob} observe une scÃ¨ne dans un autobus.`;
            }

            const graph = storyData['@graph'];
            const youthMan = graph.find(item => item['@id'] === '#youth_man');
            const conversation1 = graph.find(item => item['@id'] === '#conversation1');
            const seat = graph.find(item => item['@type'] === 'Seat');
            const button = graph.find(item => item['@type'] === 'Button');
            
            // Extract character details from JSON
            const ageRange = youthMan?.ageRange || '20-25';
            const neckDesc = youthMan?.neck ? `${youthMan.neck.name} ${youthMan.neck.height}` : 'long cou';
            const hatDesc = youthMan?.wearing?.object ? 
                `${youthMan.wearing.object.name}${youthMan.wearing.object.hasDecoration ? ` avec une ${youthMan.wearing.object.hasDecoration}` : ''}` : 
                'chapeau avec tresse';
            const conversationTone = conversation1?.emotionalTone || 'vif';
            const seatName = seat?.name || 'siÃ¨ge libre';
            const buttonName = button?.name || 'bouton supÃ©rieur';

            const templates = {
                'romantique': `Ã” douce mÃ©lancolie de cet aprÃ¨s-midi ! En tant que ${narratorJob}, mon cÅ“ur fut touchÃ© par la vision de ce jeune homme de ${ageRange} ans, au ${neckDesc} gracile, parÃ© d'un ${hatDesc} comme une couronne poÃ©tique. Dans cet autobus bondÃ©, thÃ©Ã¢tre de nos existences Ã©phÃ©mÃ¨res, une conversation au ton ${conversationTone} Ã©clata comme un orage soudain entre lui et un autre voyageur. Puis, tel un oiseau blessÃ© trouvant refuge, il dÃ©couvrit un ${seatName.toLowerCase()} et s'y posa avec dÃ©licatesse. Plus tard, sous les conseils tendres d'un ami bienveillant, il ajusta le ${buttonName} de son pardessus avec la prÃ©cision d'un poÃ¨te arrangeant ses vers les plus prÃ©cieux.`,
                
                'realiste': `Mardi, 14h30. Je suis ${narratorJob} et je prends le bus ligne 84. Un jeune homme de ${ageRange} ans environ, remarquable par son ${neckDesc}, porte un ${hatDesc}. Il monte Ã  Saint-Lazare. Une conversation ${conversationTone} Ã©clate avec un passager pour une question de place. Il finit par s'installer sur un ${seatName.toLowerCase()}. Ã€ 16h15, mÃªme jour, je le vois rue de Rome avec un ami qui examine son pardessus et lui conseille de faire attention au ${buttonName} qui semble mal ajustÃ©.`,
                
                'humoristique': `Alors lÃ , en tant que ${narratorJob}, je vous jure que j'ai assistÃ© Ã  un spectacle ! Un phÃ©nomÃ¨ne de ${ageRange} ans avec un ${neckDesc} de girafe et un ${hatDesc} complÃ¨tement farfelu qui se lance dans une discussion ${conversationTone} avec un autre voyageur ! AprÃ¨s sa petite crise de nerfs, monsieur trouve un ${seatName.toLowerCase()} et s'y installe comme un pacha. Et le pompon ? Plus tard, je le recroise avec son copain qui lui fait remarquer : "Dis donc, ton ${buttonName} lÃ , il fait n'importe quoi !" Du grand art !`,
                
                'surealiste': `Dans ce bus-aquarium flottant dans l'Ã©ther urbain, moi, ${narratorJob} des rÃªves perdus, j'aperÃ§ois un jeune homme de ${ageRange} ans dont le ${neckDesc} s'Ã©tire vers les nuages de coton. Son ${hatDesc} danse avec les mots non-dits d'une conversation ${conversationTone} qui transforme les voyageurs en poissons colorÃ©s. Il s'assoit sur un ${seatName.toLowerCase()} qui pourrait Ãªtre un trÃ´ne ou une simple chaise, selon l'angle de la rÃ©alitÃ©. Plus tard, un ami-magicien lui murmure des secrets sur le ${buttonName} de son pardessus cosmique.`,
                
                'noir': `La ville suintait sous la pluie. Moi, ${narratorJob} de cette jungle urbaine, j'observais ce jeune homme de ${ageRange} ans au ${neckDesc} suspect, coiffÃ© d'un ${hatDesc} qui cachait peut-Ãªtre plus que ses cheveux. Dans ce bus piÃ¨ge, une conversation ${conversationTone} dÃ©gÃ©nÃ©ra rapidement - on ne discute jamais innocemment dans cette ville. Il trouva refuge sur un ${seatName.toLowerCase()}, mais les prÃ©dateurs urbains n'oublient jamais. Plus tard, un soi-disant ami lui glissa quelques mots sur le ${buttonName} de son pardessus. Dans cette ville, mÃªme les conseils vestimentaires cachent des secrets.`
            };

            return templates[style] || templates['realiste'];
        }

        // Display story
        function displayStory(story, style, genre) {
            storyPlaceholder.classList.add('hidden');
            storyText.classList.remove('hidden');
            storyText.innerHTML = `
                <div class="mb-4 pb-4 border-b border-white/20">
                    <span class="bg-blue-500/30 px-3 py-1 rounded-full text-sm">ğŸ“– ${genre.charAt(0).toUpperCase() + genre.slice(1)}</span>
                    <span class="bg-purple-500/30 px-3 py-1 rounded-full text-sm ml-2">ğŸ¨ ${style.charAt(0).toUpperCase() + style.slice(1)}</span>
                </div>
                <div class="whitespace-pre-line">${story}</div>
            `;
        }

        // Show error
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            storyText.classList.add('hidden');
        }

        // Hide error
        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // Set loading state
        function setLoading(loading) {
            if (loading) {
                generateBtn.disabled = true;
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
            } else {
                generateBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        }

        // Event listeners
        generateBtn.addEventListener('click', generateStory);

        // Enter key support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !generateBtn.disabled) {
                generateStory();
            }
        });

        // Initialize the app
        window.addEventListener('load', () => {
            console.log('ğŸ­ GÃ©nÃ©rateur d\'Exercice de Style avec IA intÃ©grÃ©e');
            initializeAI();
        });
    </script>
</body>
</html> 